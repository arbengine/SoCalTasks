import{w as P,r as _,p as S,t as A,b as I,d as L,e as x,g}from"./PresentationToolGrantsCheck-BIEhXRWc.js";import{r as f,b as T,cp as J,cq as O}from"./sanity-CeuAV6R0.js";function D(t){if(Array.isArray(t)){for(const e of t)if(e!=="published"&&e!=="drafts"&&!(typeof e=="string"&&e.startsWith("r")&&e!=="raw"))throw new TypeError("Invalid API perspective value, expected `published`, `drafts` or a valid release identifier string");return}switch(t){case"previewDrafts":case"drafts":case"published":case"raw":return;default:throw new TypeError("Invalid API perspective string, expected `published`, `previewDrafts` or `raw`")}}function N(t){if(D(t),Array.isArray(t))return t.includes("published")?t:[...t,"published"];switch(t){case"previewDrafts":case"drafts":return["drafts","published"];case"published":default:return["published"]}}function R(t,e){const i=N(e);function a(r){for(const o of i){let s=null;if(o.startsWith("r")&&(s=t({...r,_id:L(r._id,o)})),o==="drafts"&&(s=t({...r,_id:x(r._id)})),o==="published"&&(s=t({...r,_id:g(r._id)})),s)return{...s,_id:g(s._id),_originalId:s._id}}return null}return function(r){return a(r)}}function q(t,e,i,a,r){var p,d;if(!e)return t;const o=R(i,r),s=((d=(p=e.documents)==null?void 0:p.map)==null?void 0:d.call(p,o))||[];return P(JSON.parse(JSON.stringify(t)),(n,h)=>{const c=_(h,e);if(!c)return n;const{mapping:u,pathSuffix:m}=c;if(u.type!=="value"||u.source.type!=="documentValue")return n;const l=e.documents[u.source.document],v=e.paths[u.source.path];if(l){const y=S(v+m),E=A(y),w=s[u.source.document];if(!w)return n;const b=w?I(w,E,n):n;return n===b?n:a(b,{cachedDocument:w,previousValue:n,sourceDocument:l,sourcePath:y})}return n})}const B=(t,{previousValue:e})=>{if(typeof e=="string"){if(typeof t=="number")return`${t}`;if(Array.isArray(t)){if(t.length===0)return"";if(t.some(i=>typeof i=="object"&&J(i)))return O(t)}}return t};function F(t){const e=f.useMemo(()=>JSON.stringify(t||{}),[t]);return f.useMemo(()=>JSON.parse(e),[e])}function M(t){const e=T.c(16),{refreshInterval:i}=t,a=k(),[r,o]=f.useState("hit");let s;e[0]===Symbol.for("react.memo_cache_sentinel")?(s=()=>(o("inflight"),()=>o("hit")),e[0]=s):s=e[0];const p=s;let d,n;e[1]!==i||e[2]!==r?(d=()=>{if(!i||r!=="hit")return;const v=setTimeout(()=>o("stale"),i);return()=>clearTimeout(v)},n=[i,r],e[1]=i,e[2]=r,e[3]=d,e[4]=n):(d=e[3],n=e[4]),f.useEffect(d,n);let h;e[5]!==r?(h=()=>{if(r!=="hit")return;const v=()=>o("stale");return window.addEventListener("focus",v),()=>window.removeEventListener("focus",v)},e[5]=r,e[6]=h):h=e[6];let c;e[7]!==i||e[8]!==r?(c=[i,r],e[7]=i,e[8]=r,e[9]=c):c=e[9],f.useEffect(h,c);let u,m;e[10]!==a||e[11]!==r?(u=()=>{a&&r==="hit"&&o("stale"),!a&&r==="stale"&&o("refresh")},m=[a,r],e[10]=a,e[11]=r,e[12]=u,e[13]=m):(u=e[12],m=e[13]),f.useEffect(u,m);let l;return e[14]!==r?(l=[r,p],e[14]=r,e[15]=l):l=e[15],l}function k(){const[t,e]=f.useState(!1);f.useEffect(()=>{e(navigator.onLine);const a=()=>e(!0),r=()=>e(!1);return window.addEventListener("online",a),window.addEventListener("offline",r),()=>{window.removeEventListener("online",a),window.removeEventListener("offline",r)}},[]);const i=f.useSyncExternalStore(W,()=>document.visibilityState,()=>"hidden");return!t||i==="hidden"}function W(t){return document.addEventListener("visibilitychange",t),()=>document.removeEventListener("visibilitychange",t)}export{M as a,q as b,B as m,F as u};
