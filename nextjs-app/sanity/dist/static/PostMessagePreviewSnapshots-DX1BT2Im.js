import{$ as g,a0 as P,r as s,bo as S,bi as _,cu as x,c8 as E,cv as M,cw as k,cx as R,ca as $,bf as h,ct as y,an as D,ai as U,ag as j,cy as F}from"./sanity-CeuAV6R0.js";function I(u){return g(function(t,r){var i=!1,n=0;t.subscribe(P(r,function(a){return(i||(i=!u(a,n++)))&&r.next(a)}))})}const O=u=>{const{comlink:t,refs:r,perspective:i}=u,n=S(),a=_(),p=s.useMemo(()=>new x,[]),l=s.useMemo(()=>p.asObservable().pipe(E(b=>M(b.map(e=>{const f={...e,_id:k(e._id)},m=i==="previewDrafts"?n.observeForPreview(f,a.get(f._type)).pipe(R(),I(o=>o.snapshot===null)):$,v={...e,_id:h(e._id)},w=n.observeForPreview(v,a.get(v._type));return y(w.pipe(D(m)),m).pipe(U(o=>!!o.snapshot),j(o=>{const c=o.snapshot;return{_id:h(c._id),title:c.title,subtitle:c.subtitle,description:c.description,imageUrl:c.imageUrl}}))}))),F(0)),[n,p,a,i]),d=s.useRef([]);return s.useEffect(()=>{const b=l.subscribe(e=>{t.post("presentation/preview-snapshots",{snapshots:e}),d.current=e});return()=>{b.unsubscribe()}},[t,l]),s.useEffect(()=>t.on("visual-editing/preview-snapshots",()=>({snapshots:d.current})),[t]),s.useEffect(()=>{p.next(r)},[r,p]),null};var N=s.memo(O);export{N as default};
