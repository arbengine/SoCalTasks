import {
  API_VERSION
} from "./chunk-2DGZHVMN.js";
import {
  filter,
  first,
  merge,
  shareReplay,
  useClient
} from "./chunk-ZOF6MRAE.js";
import "./chunk-IQQ4CL35.js";
import "./chunk-G47GRGQE.js";
import "./chunk-DG3JXI3H.js";
import "./chunk-4EOQ4HF4.js";
import {
  require_dist
} from "./chunk-B6QUAMBD.js";
import "./chunk-ZXM66L7O.js";
import "./chunk-ZMOHUIBO.js";
import "./chunk-4UOXVWM6.js";
import {
  require_react
} from "./chunk-U3RAP3IQ.js";
import {
  __toESM
} from "./chunk-5IKWDFCZ.js";

// node_modules/sanity/lib/_chunks-es/PostMessageDocuments.mjs
var import_react_compiler_runtime = __toESM(require_dist(), 1);
var import_react = __toESM(require_react(), 1);
var PostMessageDocuments = (props) => {
  const $ = (0, import_react_compiler_runtime.c)(13), {
    comlink
  } = props;
  let t0;
  $[0] === Symbol.for("react.memo_cache_sentinel") ? (t0 = {
    apiVersion: API_VERSION
  }, $[0] = t0) : t0 = $[0];
  const client = useClient(t0);
  let t1, t2;
  $[1] !== client || $[2] !== comlink ? (t1 = () => {
    const listener = client.listen('*[!(_id in path("_.**"))]', {}, {
      effectFormat: "mendoza",
      events: ["welcome", "mutation", "reconnect"],
      includePreviousRevision: false,
      includeResult: false,
      tag: "presentation-documents",
      visibility: "transaction"
    }).pipe(filter(_temp)), welcome = listener.pipe(filter(_temp2), shareReplay({
      bufferSize: 1,
      refCount: false
    })), unsubscribe = comlink.on("visual-editing/snapshot-welcome", async () => ({
      event: await new Promise((resolve) => {
        welcome.pipe(first()).subscribe((event_1) => {
          resolve(event_1);
        });
      })
    })), reconnect = listener.pipe(filter(_temp3)), mutations = listener.pipe(filter(_temp4)), events = merge(welcome, mutations, reconnect).subscribe((event_5) => {
      comlink.post("presentation/snapshot-event", {
        event: event_5
      });
    });
    return () => {
      unsubscribe(), events.unsubscribe();
    };
  }, t2 = [client, comlink], $[1] = client, $[2] = comlink, $[3] = t1, $[4] = t2) : (t1 = $[3], t2 = $[4]), (0, import_react.useEffect)(t1, t2);
  let t3, t4;
  $[5] !== client || $[6] !== comlink ? (t3 = () => comlink.on("visual-editing/fetch-snapshot", async (data) => ({
    snapshot: await client.getDocument(data.documentId, {
      tag: "document.snapshots"
    })
  })), t4 = [client, comlink], $[5] = client, $[6] = comlink, $[7] = t3, $[8] = t4) : (t3 = $[7], t4 = $[8]), (0, import_react.useEffect)(t3, t4);
  let t5, t6;
  return $[9] !== client || $[10] !== comlink ? (t5 = () => comlink.on("visual-editing/mutate", async (data_0) => client.dataRequest("mutate", data_0, {
    visibility: "async",
    returnDocuments: true
  })), t6 = [client, comlink], $[9] = client, $[10] = comlink, $[11] = t5, $[12] = t6) : (t5 = $[11], t6 = $[12]), (0, import_react.useEffect)(t5, t6), null;
};
var PostMessageDocuments$1 = (0, import_react.memo)(PostMessageDocuments);
function _temp(event) {
  return event.type === "welcome" || event.type === "reconnect" || event.type === "mutation";
}
function _temp2(event_0) {
  return event_0.type === "welcome";
}
function _temp3(event_3) {
  return event_3.type === "reconnect";
}
function _temp4(event_4) {
  return event_4.type === "mutation";
}
export {
  PostMessageDocuments$1 as default
};
//# sourceMappingURL=PostMessageDocuments-UT3AI4YA.js.map
