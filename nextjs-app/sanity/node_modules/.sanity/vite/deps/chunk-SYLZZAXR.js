import {
  isPortableTextBlock,
  toPlainText
} from "./chunk-ZOF6MRAE.js";
import {
  require_dist
} from "./chunk-B6QUAMBD.js";
import {
  require_react
} from "./chunk-U3RAP3IQ.js";
import {
  __toESM
} from "./chunk-5IKWDFCZ.js";

// node_modules/sanity/lib/_chunks-es/utils.mjs
var import_react_compiler_runtime = __toESM(require_dist(), 1);
var import_react2 = __toESM(require_react(), 1);
var mapChangedValue = (changedValue, {
  previousValue
}) => {
  if (typeof previousValue == "string") {
    if (typeof changedValue == "number")
      return `${changedValue}`;
    if (Array.isArray(changedValue)) {
      if (changedValue.length === 0)
        return "";
      if (changedValue.some((node) => typeof node == "object" && isPortableTextBlock(node)))
        return toPlainText(changedValue);
    }
  }
  return changedValue;
};
function useQueryParams(params) {
  const stringifiedParams = (0, import_react2.useMemo)(() => JSON.stringify(params || {}), [params]);
  return (0, import_react2.useMemo)(() => JSON.parse(stringifiedParams), [stringifiedParams]);
}
function useRevalidate(props) {
  const $ = (0, import_react_compiler_runtime.c)(16), {
    refreshInterval
  } = props, shouldPause = useShouldPause(), [state, setState] = (0, import_react2.useState)("hit");
  let t0;
  $[0] === Symbol.for("react.memo_cache_sentinel") ? (t0 = () => (setState("inflight"), () => setState("hit")), $[0] = t0) : t0 = $[0];
  const startRefresh = t0;
  let t1, t2;
  $[1] !== refreshInterval || $[2] !== state ? (t1 = () => {
    if (!refreshInterval || state !== "hit")
      return;
    const timeout = setTimeout(() => setState("stale"), refreshInterval);
    return () => clearTimeout(timeout);
  }, t2 = [refreshInterval, state], $[1] = refreshInterval, $[2] = state, $[3] = t1, $[4] = t2) : (t1 = $[3], t2 = $[4]), (0, import_react2.useEffect)(t1, t2);
  let t3;
  $[5] !== state ? (t3 = () => {
    if (state !== "hit")
      return;
    const onFocus = () => setState("stale");
    return window.addEventListener("focus", onFocus), () => window.removeEventListener("focus", onFocus);
  }, $[5] = state, $[6] = t3) : t3 = $[6];
  let t4;
  $[7] !== refreshInterval || $[8] !== state ? (t4 = [refreshInterval, state], $[7] = refreshInterval, $[8] = state, $[9] = t4) : t4 = $[9], (0, import_react2.useEffect)(t3, t4);
  let t5, t6;
  $[10] !== shouldPause || $[11] !== state ? (t5 = () => {
    shouldPause && state === "hit" && setState("stale"), !shouldPause && state === "stale" && setState("refresh");
  }, t6 = [shouldPause, state], $[10] = shouldPause, $[11] = state, $[12] = t5, $[13] = t6) : (t5 = $[12], t6 = $[13]), (0, import_react2.useEffect)(t5, t6);
  let t7;
  return $[14] !== state ? (t7 = [state, startRefresh], $[14] = state, $[15] = t7) : t7 = $[15], t7;
}
function useShouldPause() {
  const [online, setOnline] = (0, import_react2.useState)(false);
  (0, import_react2.useEffect)(() => {
    setOnline(navigator.onLine);
    const online_0 = () => setOnline(true), offline = () => setOnline(false);
    return window.addEventListener("online", online_0), window.addEventListener("offline", offline), () => {
      window.removeEventListener("online", online_0), window.removeEventListener("offline", offline);
    };
  }, []);
  const visibilityState = (0, import_react2.useSyncExternalStore)(onVisibilityChange, () => document.visibilityState, () => "hidden");
  return !online || visibilityState === "hidden";
}
function onVisibilityChange(onStoreChange) {
  return document.addEventListener("visibilitychange", onStoreChange), () => document.removeEventListener("visibilitychange", onStoreChange);
}

export {
  mapChangedValue,
  useQueryParams,
  useRevalidate
};
//# sourceMappingURL=chunk-SYLZZAXR.js.map
